[gcode_macro M300]
description: Play Tone
gcode:
    {% set frequency = params.S|default(1000)|int %} # 1kHz
    {% set duration = params.P|default(100)|int %} # 10ms

    {% set cycle_time = 1.0|float %}
    {% if frequency > 0 %}
        {% set cycle_time = 1.0 / frequency %}
    {% endif %}

    SET_PIN PIN=BEEPER_pin VALUE=0.5 CYCLE_TIME={cycle_time}
    G4 P{duration}
    SET_PIN PIN=BEEPER_pin VALUE=0
